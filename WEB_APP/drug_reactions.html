<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<title>Drug &amp; Reactios Reports</title>
		
		<script src="./js/modernizr.js"></script>
		<link rel="stylesheet" href="./css/foundation.css" />
		<link rel="stylesheet" href="./css/jquery.dataTables.css"/>
		<link rel="stylesheet" href="./css/main.css"> 	
	</head>
	
	<body>
		<!-- HEADER-->
		<div class="row">
			<div class="large-3 columns">
				<h1><img src="./img/logo.png"/></h1>
			</div>
			<div class="large-9 columns">
				<ul class="right button-group">
					<li><a href="./index.html" class="button">Home</a></li>
					<li><a href="./about_us.html" class="button">About Us</a></li>
					<li><a href="#" class="button"><img src="./img/help.png" width="12px" height="12px"> Help</a></li>
				</ul>
			</div>
		</div>   
		<!-- HEADER END-->

		<div class="row">     
			<div class="large-9 push-3 columns">
				<h3>Drug &amp; Reaction Reports</h3>
				<div class="small-3 columns">				
					<label for="drugOption">Select a drug:</label> <select id="drugOption"></select>
					<label for="reactionOption">Select a reaction:</label> <select id="reactionOption"></select><br>
					<button id="myButton">Search</button>
				</div>
				<div class="push-4" style="float:top-right;">
					<img src="./img/shutterstock_98521175.jpg" width="40%" height="40%"/>
				</div>
				
				<br><br>
				
				<table id="report" class="display" cellspacing="0" width="100%">
			        <thead>
			            <tr>
			                <th>Name</th>
			                <th>Position</th>
			                <th>Office</th>
			                
			            </tr>
			        </thead>
			 
			        <tfoot>
			            <tr>
			                <th>Name</th>
			                <th>Position</th>
			                <th>Office</th>
			              
			            </tr>
			        </tfoot>
			    </table>
			</div>
			<div class="large-3 pull-9 columns panel">				
				<ul class="side-nav">
					<li><a href="./index.html">Home</a></li>
					<li><a href="./reporting_ratios.html">Reporting Rations</a></li>
					<li><a href="./drug_reactions.html">Drug &amp; Reactions Reports</a></li>
				</ul>
			</div>
		</div>

		<!-- FOOTER-->
		<footer class="row">
			<div class="large-12 columns">
				<hr/>
				<div class="row">
					<div class="large-6 columns">
					  <p>&copy; Copyright 2015 WTS</p>
					</div>
					<div class="large-6 columns">
						<ul class="inline-list right">
							<li><a href="#">Terms of Use</a></li>
							<li><a href="#">Privacy</a></li>
							<li><a href="#">Sitemap</a></li>
							<li><a href="./about_us.html">About Us</a></li>
						</ul>
					</div>
				</div>
			</div> 
		</footer>  
		<!-- FOOTER END-->
	
		 
		
		<script src="./js/jquery.js" type="text/javascript"></script>
		<script src="./js/foundation.min.js"></script>
		<script src="./js/underscore-min.js" type="text/javascript"></script>
		<script src="./js/backbone-min.js" type="text/javascript"></script>
		<script src="./js/jquery.dataTables.min.js" type="text/javascript"></script>
		<script src="" type="text/javascript"></script>

		<script>
			$(document).foundation(); 

			// We extend the Backbone.Model prototype to build our own
			var drugModel = Backbone.Model.extend({
			  // We can pass it default values.
				defaults : {
					name : ''
				}
			});	

			var drugCollection = Backbone.Collection.extend({
				model : drugModel,
				url : "http://localhost:8080/api/adsi/1.0/drugs",
				parse : function(response){
					var self = this;
					_.each(response, function(drug){
						self.add(drug);
						$("#drugOption").append("<option id='"+drug.name+"'>"+drug.name+"</option>");
					});
				}
			});
  
			var myDrugCollection = new drugCollection;
			myDrugCollection.fetch(); // this makes a call to the server and populates the collection based on the response.	
					
			
			// We extend the Backbone.Model prototype to build our own
			var reactionModel = Backbone.Model.extend({
			  // We can pass it default values.
				defaults : {
					preferredTerm : ''
				}
			});	

			var reactionCollection = Backbone.Collection.extend({
				model : reactionModel,
				url : "http://localhost:8080/api/adsi/1.0/reactions",
				parse : function(response){
					var self = this;
					_.each(response, function(reaction){
						self.add(reaction);
						$("#reactionOption").append("<option id='"+reaction.preferredTerm+"'>"+reaction.preferredTerm+"</option>");
					});
				}
			});
  
			var myReactionCollection = new reactionCollection;
			myReactionCollection.fetch(); // this makes a call to the server and populates the collection based on the response.	
			
			//{"drug":{"name":"[XXX]"},"proportionalReportingRatio":1.7,"reaction":{"preferredTerm":"[YYY]"},"relativeReportingRatio":1.42,"reportingOddsRatio":1.1}
			
			// We extend the Backbone.Model prototype to build our own
			var reportModel = Backbone.Model.extend({
			  // We can pass it default values.
				defaults : {
					drug : '',
					proportionalReportingRatio : 0,
					preferredTerm: '',
					relativeReportingRatio : 0,
					reportingOddsRatio : 0					
				}
			});	
			var reportCollection = Backbone.Collection.extend({
				model : reportModel,
				url : function(){
					var d = $("#drugOption").val();
					var r = $("#reactionOption").val();
					var url = "http://localhost:8080/api/adsi/1.0/correlations?drug="+d+"&reaction="+r;
					return url;
				},
				parse : function(response){
					//alert('parse'+JSON.stringify(response));
					$("#PRR").html(response.proportionalReportingRatio);
					$("#RRR").html(response.relativeReportingRatio);
					$("#ROR").html(response.reportingOddsRatio);
					return response;
				}
			});
			
			$('#myButton').click(function () {	
				selectedDrug = $("#drugOption").val();
				selectedReaction = $("#reactionOption").val();
				var myReportCollection = new reportCollection;
				var s = myReportCollection.fetch({ 
				    data: { proportionalReportingRatio: 2.7 },
				    processData: true
				});
				var selectedDrug=$("#showDrug").html(selectedDrug);
				var selectedReaction=$("#showReaction").html(selectedReaction);
			}); 
			
			$(document).ready(function() {
			    $('#report').dataTable( {
			        "data":[ ["Airi",    	      "Satou",     	      "Accountant"    	    ],
			        	    [	      "Angelica",  	      "Ramos",    	      "Chief Executive Officer (CEO)"  	]]
			    } );
			} );
			
 
		</script>
	</body>
</html>